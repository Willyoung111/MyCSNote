# MYSQL基本架构示意图

MYSQL由Server层和存储引擎层两部分

<img src="数据库.assets/0d2070e8f84c4801adbfa03bda1f98d9.png" alt="img" style="zoom: 33%;" />

- Server层：涵盖MYSQL大多数核心服务功能，以及所有内置函数。所有**跨存储引擎功能**在这一层实现，如存储过程、触发器、视图。
- 存储引擎层：负责数据的存储和提取。其架构模式是**插件式**的，支持InnoDB、MyISAM、Memory等多个存储引擎。**InnoDB从MySQL 5.5.5版本开始成为了默认存储引擎**

# 一条MYSQL语句的执行过程

**连接器**：连接到数据库。连接器负责跟客户端建立连接，获取权限，维持和管理连接。

**查询缓存**：MYSQL拿到查询请求后，会首先通过查询缓存看看之前是不是执行过这条语句。执行过则直接从缓存返回结果。

查询缓存往往**弊大于利**，查询缓存失效非常频繁，只要有表更新，这个表上所有的查询缓存都会被清空。**MYSQL8.0删除了查询缓存的功能。**

**分析器**：对输入的SQL语句做**词法分析**和**语法分析**。

**优化器**：在表里有**多个索引**时，用于决定使用哪个索引；或者在一个语句有**多表关联(join)**时，决定各个表的连接顺序。（优化器选择索引的方法）

**执行器**：执行器首先判断对表T是否有执行权限。有权限则调用引擎提供的接口。（取下一行、取满足条件的下一行）

> Q：如果表T中没有字段k，而你执行了这个语句 select * from T where k=1, 那肯定是会报“不存在这个列”的错误： “Unknown column ‘k’ in ‘where clause’”。你觉得这个错误是在我们上面提到的哪个阶段报出来的呢？
>
> A：分析器，分析器阶段会判断语句是否正确，表、列是否存在。不是执行器，因为表、列的字段是事先定义好的，不是存在存储引擎中的数据，不需要打开引擎去读取。
>
> Q：如果是一个对表T没有权限的用户执行此语句，报错是“select command denied”，而不是“unknown column”
>
> A：出于安全性考虑，对没有权限的用户，其也没有权限知道列k是否存在。

# 一条MYSQL更新语句的执行过程



### 极高频，不会很危险

知道哪些存储引擎，InnoDB和MyISAM区别和特点，适用于什么场景

索引使用的数据结构，为什么使用b+树，和b树、红黑树、hash表的比较

什么是聚集索引、辅助索引，如何避免回表，覆盖索引

联合索引及其要求（最左匹配等，通常考察方式是给一个表和sql问是否走索引及为什么）

事务的ACID四大特性、事务的隔离级别、脏读、不可重复读、幻读

### 高频，应当熟练

多表查询中内连接、外连接、笛卡尔积等

select * from t where * group by * having * order by * limit * 标准查询语句（字节常考SQL题）

三大范式

一条SQL语句查询很慢有哪些解决方法

SQL注入攻击及预编译

你知道MySQL中有哪些日志（重点是binary log、redo log、undo log），他们的区别、作用是什么？

MVCC的作用、原理、MySQL是怎么实现的

索引优化，选取怎样的列作索引列，怎么安排索引列的顺序，如果有几个查询任务你怎样建立索引，索引失效的场景有哪些

读锁、写锁、（后面几个是我觉得完整的知识体系必须具备的，面试中能主动提到或者答上来绝对是极大的加分点：意向锁、next-key lock、gap lock）

MySQL两个账户相互转账会发生什么，如何解决出现的死锁问题

MySQL是如何解决脏读、不可重复读、幻读的？前两个是mvcc、后一个是next-key lock

事务的持久性是如何保证的？（可以想想隔离性、原子性、一致性又是如何保证的，这三个不常问，但是勤思考总是没错的）

### 一般，拓宽知识，加分项

MySQL支持的基本数据类型（问的较少，但是不会的话场面会很难看）

主键、外键、唯一约束、视图等知识

分区分表（根据功能、业务、访问频率等按列分，根据时间、用户、hash等按行分）

查询语句优化技巧，如覆盖索引的延迟关联、limit 10000000， 100语句的优化、explain的运用

一条sql语句的执行过程（包括查询和修改两大类操作）

什么是快照读和当前读

MySQL复制是如何实现的？主从复制的好处是什么？